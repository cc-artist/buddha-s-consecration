## 部署方案概述

### 项目结构分析
- **前端**：Next.js 应用，运行在端口 3000
- **后端**：Express.js 应用，运行在端口 3001
- **管理界面**：位于 `backend/admin.html`

## 部署方案

### 步骤1：云服务器准备
1. 选择云服务器（推荐：AWS EC2、阿里云 ECS、腾讯云 CVM）
2. 安装 Node.js 16+ 和 npm
3. 配置安全组，开放 3000 和 3001 端口

### 步骤2：项目部署
1. **克隆代码**：
   ```bash
   git clone https://github.com/cc-artist/Buddha-s-consecration.git
   cd Buddha-s-consecration
   ```

2. **安装依赖**：
   ```bash
   # 安装前端依赖
   cd cyber-buddha-blessing
   npm install
   
   # 安装后端依赖
   cd ../backend
   npm install
   ```

3. **构建前端**：
   ```bash
   cd ../cyber-buddha-blessing
   npm run build
   ```

4. **启动服务**：
   - 使用 PM2 管理进程（推荐）：
     ```bash
     # 全局安装 PM2
     npm install -g pm2
     
     # 启动后端
     cd backend
     pm2 start src/index.js --name "cyber-buddha-backend"
     
     # 启动前端（生产模式）
     cd ../cyber-buddha-blessing
     pm2 start npm --name "cyber-buddha-frontend" -- run start
     ```

### 步骤3：后端管理界面访问

**访问链接**：`http://<服务器IP>:3001/admin.html`

**认证方式**：
- 管理界面使用会话认证
- 默认登录凭据（可在 `backend/src/config/mockData.js` 中配置）

### 步骤4：环境配置

创建 `.env` 文件（前端和后端各一个）：

**前端环境变量** (`cyber-buddha-blessing/.env.local`)：
```
NEXT_PUBLIC_API_URL=http://<服务器IP>:3001/api/v1
NEXT_PUBLIC_APP_ENV=production
```

**后端环境变量** (`backend/.env`)：
```
PORT=3001
NODE_ENV=production
ALLOWED_ORIGINS=http://<服务器IP>:3000,http://localhost:3000
SESSION_SECRET=your-secret-key
API_PREFIX=/api/v1
```

### 步骤5：部署自动化脚本

创建 `deploy.sh` 脚本，用于自动化部署：

```bash
#!/bin/bash

echo "=== 赛博佛祖部署脚本 ==="

# 停止现有进程
echo "停止现有进程..."
pm2 stop all

# 更新代码
echo "拉取最新代码..."
git pull

# 安装依赖
echo "安装依赖..."
cd cyber-buddha-blessing
npm install
cd ../backend
npm install
cd ..

# 构建前端
echo "构建前端..."
cd cyber-buddha-blessing
npm run build
cd ..

# 启动服务
echo "启动后端服务..."
cd backend
pm start &
cd ..

echo "启动前端服务..."
cd cyber-buddha-blessing
npm run start &
cd ..

echo "=== 部署完成 ==="
echo "前端访问: http://<服务器IP>:3000"
echo "后端API: http://<服务器IP>:3001"
echo "管理界面: http://<服务器IP>:3001/admin.html"
```

## 打包配置

### 步骤1：创建部署文档

创建 `DEPLOYMENT.md` 文件，包含完整部署指南。

### 步骤2：配置打包脚本

在项目根目录创建 `package.json`，添加打包脚本：

```json
{
  "scripts": {
    "deploy:package": "bash scripts/create-deployment-package.sh"
  }
}
```

### 步骤3：创建打包脚本

创建 `scripts/create-deployment-package.sh`：

```bash
#!/bin/bash

echo "=== 创建部署包 ==="

# 创建部署目录
mkdir -p deployment

# 复制必要文件
cp -r cyber-buddha-blessing deployment/
cp -r backend deployment/
cp DEPLOYMENT.md deployment/
cp deploy.sh deployment/

# 创建压缩包
tar -czf cyber-buddha-deployment.tar.gz deployment/

echo "=== 部署包创建完成: cyber-buddha-deployment.tar.gz ==="
```

## 技术说明

- **反向代理**：生产环境推荐使用 Nginx 作为反向代理，统一端口访问
- **数据库**：如需持久化存储，可配置 MongoDB 或 MySQL
- **SSL 证书**：使用 Let's Encrypt 获取免费 SSL 证书，启用 HTTPS

此方案提供了完整的云服务器部署指南，包括管理界面访问方式、环境配置和自动化部署脚本，可直接打包到项目文件中使用。